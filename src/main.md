Браузер для macOS на Rust + CEF

Технический план разработки

1. Описание проекта

Проект — десктопный браузер для macOS, архитектурно и функционально близкий к Atlas, но без ИИ, истории, закладок и пользовательского профиля.

Основные цели:

встраивание Chromium через CEF (Chromium Embedded Framework);
основной код приложения на Rust;
нативный desktop UX (окна, вкладки, кнопки навигации);
возможность взаимодействия с DOM и JavaScript страниц.
Браузер ориентирован на:
быстрый прототип;
инструментальный / developer-first use-case;
расширяемую архитектуру (в будущем можно добавить ИИ, devtools, persistence).

Поддерживаемая платформа: macOS (ARM64 + x86_64)

2. Архитектура проекта
   2.1 Общая схема
   +-----------------------------+
   | macOS App (.app bundle)     |
   |                             |
   |  +-----------------------+  |
   |  | Rust Application      |  |
   |  | (Browser Process)    |  |
   |  |                       |  |
   |  |  - Window Manager     |  |
   |  |  - Tab Manager        |  |
   |  |  - UI Controller      |  |
   |  |  - CEF Bindings       |  |
   |  +----------+------------+  |
   |             | IPC            |
   |  +----------v------------+  |
   |  | CEF Render Process    |  |
   |  |                       |  |
   |  |  - HTML / CSS / JS    |  |
   |  |  - DOM                |  |
   |  |  - Page Rendering     |  |
   |  +-----------------------+  |
   +-----------------------------+

2.2 Процессы CEF
Browser Process (Rust)
управление окнами и вкладками
обработка пользовательского ввода
вызовы навигации и JS
получение HTML
Render Process (CEF)
выполнение JavaScript
построение DOM
рендеринг страницы
CEF по умолчанию использует мультипроцессную модель, где рендер-процесс изолирован от основного приложения.

2.3 GUI слой

Варианты реализации UI:
Cocoa (NSWindow, NSSplitView)
либо Rust GUI (winit + нативные хендлы)
Основное окно содержит:
панель вкладок
кнопки навигации
область web-view
боковую панель

2.4 Стек технологий
Слой	Технология
Язык	Rust
Web engine	CEF
UI	Cocoa / winit
IPC	CEF IPC
DOM parsing	html5ever / scraper
Сборка	cargo + CEF bundle

3. Список фичей
   Боковая панель (Side Panel)
   Поддержка вкладок
   Взаимодействие с веб-страницами (JS + DOM)
   Парсинг DOM
   Навигация (Back / Forward)

4. Детализация фичей

4.1 Боковая панель (Side Panel)
Функциональные требования
отображается слева или справа от основного контента;
может быть показана / скрыта;
содержит собственный web-view или UI;
не влияет на вкладки.

## Техническая реализация
использовать split-view (NSSplitView или аналог);
создать отдельный экземпляр CefBrowser;
встраивать browser как child-window;
загрузка контента через LoadURL;
управление видимостью через UI слой.

4.2 Поддержка вкладок

## Функциональные требования

открытие новой вкладки;
переключение между вкладками;
закрытие вкладки;
независимая навигация для каждой вкладки.

## Техническая реализация

каждая вкладка = отдельный CefBrowser;
TabManager хранит список вкладок;
при переключении:
скрывать предыдущий web-view;
показывать активный;
закрытие вкладки → browser.close();
один CefRequestContext для всех вкладок.

4.3 Взаимодействие с веб-страницами (JS + DOM)

## Функциональные требования

выполнять произвольный JavaScript;
получать результаты выполнения;
читать и изменять DOM.

## Техническая реализация

использовать ExecuteJavaScript у CefFrame;
передача данных через:
IPC сообщения;
JS → Rust callbacks;
DOM-доступ через JS:
document.querySelector(...)
выполнение JS только после OnLoadEnd.

4.4 Парсинг DOM
Функциональные требования
получать DOM-структуру страницы;
извлекать элементы и текст;
использовать в Rust-коде.

## Техническая реализация
получить HTML:
document.documentElement.outerHTML
или CefFrame::GetSource;
разобрать HTML через:
html5ever
scraper
построить DOM-дерево в Rust;
использовать для анализа / экстракции данных.

4.5 Навигация (Back / Forward)

## Функциональные требования

кнопки «Назад» и «Вперёд»;
кнопки активны только при возможности перехода;
навигация внутри вкладки.

## Техническая реализация
использовать:
browser.go_back()
browser.go_forward()

проверка состояния:
browser.can_go_back()
browser.can_go_forward()

обновление UI при OnLoadEnd.

5. Структура проекта
   browser/
   ├─ src/
   │  ├─ main.rs
   │  ├─ app/
   │  │  ├─ window.rs
   │  │  ├─ tabs.rs
   │  │  ├─ sidebar.rs
   │  │  └─ navigation.rs
   │  ├─ cef/
   │  │  ├─ init.rs
   │  │  ├─ browser.rs
   │  │  └─ handlers.rs
   │  └─ dom/
   │     └─ parser.rs
   ├─ resources/
   │  └─ cef/
   ├─ Cargo.toml
   └─ README.md